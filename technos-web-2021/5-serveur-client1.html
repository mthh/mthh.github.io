<!DOCTYPE html>
<html lang="fr" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <title>Programmation Web cot√© serveur en Python - Cours Technologies Web - LP ESSIG - 2021</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="src/custom.css">
        
        <link rel="stylesheet" href="src/bootstrap-scoped.min.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try {
                  sidebar = localStorage.getItem('mdbook-sidebar');
                } catch(e) {
                  sidebar = 'visible';
                }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded affix "><a href="0.html">Accueil</a></li><li class="expanded "><a href="1-Intro.html"><strong aria-hidden="true">1.</strong> √âl√©ments th√©oriques</a></li><li class="expanded "><a href="2-HTML_CSS.html"><strong aria-hidden="true">2.</strong> Intro HTML 5 / CSS 3</a></li><li class="expanded "><a href="3-structure-style.html"><strong aria-hidden="true">3.</strong> Structurer et styler un document HTML</a></li><li class="expanded "><a href="4-css-bootstrap.html"><strong aria-hidden="true">4.</strong> Le framework Bootstrap</a></li><li class="expanded "><a href="5-serveur-client1.html" class="active"><strong aria-hidden="true">5.</strong> Programmation Web cot√© serveur en Python</a></li><li class="expanded "><a href="6-serveur-client2.html"><strong aria-hidden="true">6.</strong> Interactions serveur/client, formulaires et BD</a></li><li class="expanded "><a href="7-serveur-client3.html"><strong aria-hidden="true">7.</strong> Interactions serveur/client (suite)</a></li><li class="expanded "><a href="8-javascript.html"><strong aria-hidden="true">8.</strong> Javascript - Th√©orie et pratique</a></li><li class="expanded "><a href="tbd.html"><strong aria-hidden="true">9.</strong> Technos Web... quoi d'autre ?</a></li><li class="spacer"></li><li class="expanded affix "><a href="glossaire.html">Glossaire - M√©mo</a></li><li class="expanded affix "><a href="page_pdf.html">Version PDF des TP</a></li><li class="expanded affix "><a href="tp_data.html">Donn√©es TP &amp; Corrections</a></li><li class="expanded affix "><a href="exam.html">Pr√©c√©dents sujets d'examen</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Cours Technologies Web - LP ESSIG - 2021</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#programmation-web-cot√©-serveur-en-python" id="programmation-web-cot√©-serveur-en-python">Programmation Web cot√© serveur en Python</a></h1>
<h2><a class="header" href="#1-pr√©ambule" id="1-pr√©ambule">1. Pr√©ambule</a></h2>
<h3><a class="header" href="#11-langages-cot√©-client-et-langages-cot√©-serveur-" id="11-langages-cot√©-client-et-langages-cot√©-serveur-">1.1 Langages cot√© client et langages cot√© serveur ...</a></h3>
<p>HTML <em>(HyperText Markup Language)</em> et CSS <em>(Cascading Style Sheet)</em>, sont deux langages de simple affichage statique de contenus (statique car rien ne change, le contenu est toujours le m√™me).</p>
<p>Les langages de script permettent de produire des pages web non statiques, c‚Äôest-√†-dire dont le contenu peut varier en fonction de diff√©rentes conditions (et notamment des actions de l'utilisateur).</p>
<p>Il existe des langages c√¥t√© client (le principal actuellement est Javascript) et des langages c√¥t√© serveur.</p>
<p><strong>PHP</strong> est un c√©l√®bre exemple de langage de programmation qui s‚Äôex√©cute c√¥t√© serveur. Ce langage permet de produire du code, visualisable par le client, qui peut diff√©rer en fonction de circonstances d√©finies, ce qui introduit donc un certain dynamisme. Ce dynamisme peut √™tre accru gr√¢ce √† une connexion avec une base de donn√©es (PostGreSQL, MySQL, SQLite, etc.).</p>
<div class="center" style="border: solid 3px black; border-radius: 10px;">
<p><img src="1-Intro-Internet-web/img/traitement_page_serveur.png" alt="" /></p>
<p class="source center" style="font-size: 0.85em;">Source: Marl√®ne Villanova-Oliver</p>
</div>
<p>La figure ci-dessus (√©galement pr√©sent√©e dans les slides du 1er cours) pr√©sente l‚Äôarchitecture couplant un langage de programmation et une base de donn√©es afin de g√©n√©rer, sur le serveur, du contenu dynamique lors d'une requ√™te en provenance d'un client (navigateur Web) : c'est ce que nous allons impl√©menter dans les 2 prochains TP.<br />
<strong>Nous n'utiliserons pas le langage PHP mais le langage Python avec le <em>micro-framework</em> <code>Flask</code>.</strong></p>
<p>Il existe de nombreux <em>frameworks</em> de programmation de <strong>serveur</strong> Web dans un multitude de langages, par exemple :</p>
<ul>
<li>en PHP : <code>laravel</code>, <code>Symphony</code>,</li>
<li>en Python : <code>Django</code>, <code>Flask</code>, <code>cherry.py</code></li>
<li>en JavaScript avec node.js : <code>Express.js</code>,</li>
<li>en Java : <code>Spring</code>, ...</li>
<li>en Ruby : <code>Ruby on Rails</code>, ...</li>
</ul>
<p>Les logiciels <a href="https://fr.wikipedia.org/wiki/Apache_HTTP_Server"><code>Apache HTTP server</code></a> et <a href="https://fr.wikipedia.org/wiki/NGINX"><code>NGINX</code></a> sont √©galement des serveurs HTTP.</p>
<p>Au m√™me titre, il existe diff√©rents <strong>clients</strong>, que vous utilisez ou connaissez d√©j√† pour certains puisqu'il s'agit notamment des navigateurs Web :</p>
<ul>
<li><code>Chrome</code>, <code>Firefox</code>, <code>Microsoft Edge</code>, etc.</li>
<li>En ligne de commande : <a href="https://fr.wikipedia.org/wiki/CURL"><code>cURL</code></a>, <a href="https://fr.wikipedia.org/wiki/GNU_Wget"><code>Wget</code></a></li>
<li>Des biblioth√®ques proposent d'effectuer des requ√™tes HTTP dans la plupart des langages de programmation (<a href="https://requests.readthedocs.io/en/master/"><code>requests</code></a> et <a href="https://www.python-httpx.org/"><code>httpx</code></a> en Python par exemple)</li>
</ul>
<h3><a class="header" href="#12-le-protocole-http" id="12-le-protocole-http">1.2 Le protocole HTTP</a></h3>
<p>Dans le 1er cours, nous avons √©voqu√© le protocole HTTP (pour <em>Hypertext Transfer Protocol</em>, litt√©ralement &quot;protocole de transfert hypertexte&quot;). Il s'agit d'un <strong>protocole de communication client-serveur</strong> (se situant au niveau &quot;application&quot; du mod√®le en couches pr√©sent√© √† cette occasion et dont l'illustration est rappel√©e ci-dessous).</p>
<div class="center">
<p><img src="1-Intro-Internet-web/img/dataflow_ips_wikipedia.png" alt="" /></p>
<p class="source center" style="font-size: 0.85em;">Source: <a href="https://commons.wikimedia.org/wiki/File:Data_Flow_of_the_Internet_Protocol_Suite.PNG">Wikimedia Commons - user: renepick</a> / <a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA-3.0</a></p>
</div>
<div class="center">
<p><img src="1-Intro-Internet-web/img/client-server-mdn.png" alt="" /></p>
<p><span class="source" style="display: block;padding-right: 86px;font-size: 0.85em;">Source: <a href="https://developer.mozilla.org/files/4291/client-server.png">Mozilla Developpers Network</a></span></p>
</div>
<p>Le protocole HTTP d√©finie plusieurs <strong>m√©thodes</strong>. Une m√©thode est une commande sp√©cifiant au serveur un <strong>type de requ√™te</strong>, lui demandant d'effectuer une action particuli√®re sur la ressource d√©sign√©e par l'URL qui accompagne cette m√©thode.</p>
<p>Les m√©thodes qui seront utilis√©es dans cette s√©rie de TP sont les suivantes (il s'agit √©galement des plus utilis√©es):</p>
<ul>
<li><strong><code>GET</code></strong> : m√©thode pour demander une ressource (une requ√™te <code>GET</code> est sans effet sur la ressource, on peut la r√©p√©ter et obtenir le m√™me r√©sultat), c'est la m√©thode utilis√©e lors de la r√©cup√©ration d'une page Web par exemple.</li>
<li><strong><code>POST</code></strong> : m√©thode pour transmettre des donn√©es en vue de leur traitement (par exemple depuis un formulaire HTML)</li>
</ul>
<p><strong>‚Üí Concr√™tement, lorsqu'une page HTML est consult√©e, la premi√®re √©tape consiste √† la r√©cup√©rer : une requ√™te HTTP de type <code>GET</code> sur l'url de la page est effectu√©e</strong>.</p>
<p><strong>‚Üí De m√™me, lorsque vous validez un formulaire, une requ√™te HTTP de type <code>POST</code> est effectu√©e sur une url du serveur permettant de valider et de traiter le formulaire</strong>.</p>
<p>Ces autres m√©thodes sont parfois utilis√©es (notamment lors de l'utilisation d'une API de type REST pour les 3 derni√®res), gardez leur nom en t√™te pour savoir qu'il s'agit de m√©thodes HTTP si vous les rencontrez :</p>
<ul>
<li><code>HEAD</code> : m√©thode pour demander des informations sur la ressource, sans r√©cup√©rer la ressource.</li>
<li><code>PUT</code> : m√©thode pour remplacer ou ajouter une ressource.</li>
<li><code>DELETE</code> : m√©thode pour supprimer une ressource.</li>
<li><code>PATCH</code> : m√©thode pour faire une modification partielle (contrairement √† <code>PUT</code> qui la remplacerait) d'une ressource.</li>
</ul>
<h3><a class="header" href="#13-le-fil-rouge-de-ce-tp-et-des-suivants-" id="13-le-fil-rouge-de-ce-tp-et-des-suivants-">1.3 Le fil rouge de ce TP et des suivants ...</a></h3>
<p>Nous souhaitons construire <strong>une plate-forme collaborative permettant de noter et de donner un avis sur les b√¢timents du campus</strong>. Cette t√¢che complexe peut-√™tre d√©compos√©e en plusieurs sous-t√¢ches:</p>
<ul>
<li>cr√©er une base de donn√©es permettant de stocker cette information</li>
<li>donner √† l'utilisateur la possibilit√© de consulter l'information (localisation des b√¢timents not√©s et d√©tails des notes/avis)</li>
<li>donner √† l'utilisateur la possibilit√© de saisir une nouvelle information (ajout d'une note/avis √† une localisation en ayant d√©j√† o√π non)</li>
</ul>
<p>Aujourd'hui (<strong>TP5</strong>), nous verrons comment organiser le code cot√© serveur pour que diff√©rentes actions puissent √™tre effectu√©es en fonction du type de requ√™te ou du chemin de la requ√™te <em>(i.e. comment passer d'un contenu statique √† un contenu dynamique)</em> et nous verrons comment utiliser des <em>templates</em> HTML.</p>
<p>Le <strong>TP6</strong> servira √† cr√©er un formulaire dans la page HTML et √† le traiter cot√© serveur pour ajouter son contenu dans une base de donn√©es <a href="https://www.sqlite.org/">SQLite</a>. Les informations pr√©sentes dans la base de donn√©es seront mobilis√©es pour √™tre affich√©es cot√© client ; elles pourront √©galement √™tre mises √† jour.</p>
<p>Le <strong>TP7</strong> servira √† ajouter une carte interactive dans la page HTML. C'est cette carte qui sera utilis√©e comme interface pour l'ajout d'avis (lors du clic de l'utilisateur par exemple) ainsi que pour l'affichage de la localisation des avis pr√©sents dans la base de donn√©es (sous forme de <em>markers</em>). Cette carte fera appel √† du code Javascript, ex√©cut√© directement dans le navigateur web du client. L'application construite pourra √™tre d√©ploy√©e individuellement sur la plate-forme <a href="https://www.pythonanywhere.com/">PythonAnywhere</a>.</p>
<p>Le <strong>TP8</strong>, sera consacr√© au langage Javascript (aspects th√©oriques et pratiques) afin d'ajouter de l'interactivit√© et des fonctionnalit√©s suppl√©mentaire √† l'application cr√©√©e.</p>
<h2><a class="header" href="#2-la-biblioth√®que-flask" id="2-la-biblioth√®que-flask">2. La biblioth√®que <code>Flask</code></a></h2>
<p>Il s'agit d'un <em>micro-framework</em> con√ßu pour d√©velopper une application Web cot√© serveur. √Ä ce titre il va fournir des outils g√©n√©riques pour cr√©er ce type d'application tout en favorisant la mise en oeuvre de bonnes pratiques et en limitant l'√©criture de code inutile. Le qualificatif <em>micro</em> d√©crit ici plusieurs r√©alit√©s :</p>
<ul>
<li>vise √† garder le code de base simple mais extensible,</li>
<li>n'est pas opini√¢tre dans le choix d'une base de donn√©es,</li>
<li>au final, <code>Flask</code> s'occupe de l'essentiel (g√©rer les routes et les requ√™tes HTTP et permettre l'utilisation de <em>templates</em>) mais les autres t√¢ches &quot;optionnelles&quot; (connexion √† une DB, authentification, formulaires, etc.) sont laiss√©es √† des extensions.</li>
</ul>
<p><strong><code>Flask</code></strong> repose notamment sur deux biblioth√®ques dont il est utile d'avoir connaissance : <code>Werkzeug</code> (une boite √† outils WSGI) et <code>Jinja2</code> (un moteur de <em>template</em>).</p>
<div class="center smallcontent">
<p><img src="https://flask.palletsprojects.com/en/1.1.x/_images/flask-logo.png" alt="" /></p>
</div>
<p><strong>Liens utiles:</strong></p>
<ul>
<li>Documentation officielle de <code>Flask</code>: <a href="https://flask.palletsprojects.com/en/1.1.x/">https://flask.palletsprojects.com/en/1.1.x/</a></li>
<li>Documentation officielle de <code>Jinja2</code>: <a href="https://jinja.palletsprojects.com/en/2.11.x/">https://jinja.palletsprojects.com/en/2.11.x/</a></li>
<li>Documentation officielle de <code>Werkzeug</code> : <a href="https://werkzeug.palletsprojects.com/en/0.16.x/">https://werkzeug.palletsprojects.com/en/0.16.x/</a></li>
<li>Liste de <em>plugins</em> et de ressources pour <code>Flask</code>: <a href="https://github.com/humiaozuzu/awesome-flask">https://github.com/humiaozuzu/awesome-flask</a></li>
</ul>
<h3><a class="header" href="#21-premier-pas-avec-flask---application-et-routes" id="21-premier-pas-avec-flask---application-et-routes">2.1 Premier pas avec Flask - Application et routes</a></h3>
<h4><a class="header" href="#application" id="application">Application</a></h4>
<p><u>Code :</u></p>
<pre><code class="language-python">from flask import Flask

app = Flask(__name__)

@app.route(&quot;/route1&quot;)
def root():
    return &quot;Hello from Flask!&quot;
</code></pre>
<p><span class="tryit">Pour tester</span> : <a href="http://mthh.pythonanywhere.com/route1">http://mthh.pythonanywhere.com/route1</a></p>
<p><u>Explications :</u></p>
<ul>
<li><code>app</code> d√©signe une application Flask;</li>
<li>la fonction <code>root</code> est appel√©e une <strong>vue</strong>. Elle retourne une cha√Æne de caract√®res, qui sera le contenu de la r√©ponse. Par d√©faut, le statut de la r√©ponse est 200, et le type de contenu est HTML, encod√© en UTF-8;</li>
<li>la ligne qui pr√©c√®de la fonction <code>root</code> est un <strong><a href="https://www.python.org/dev/peps/pep-0318/">d√©corateur</a></strong>, il sert ici √† sp√©cifier l‚ÄôURL pour laquelle cette vue doit √™tre utilis√©e (sa <em><strong>route</strong></em>). Ce d√©corateur est une m√©thode de l'objet <code>app</code>, l'application Flask, cr√©√©e au-dessus, dans laquelle s'inscrit cette route.</li>
</ul>
<h4><a class="header" href="#routes" id="routes">Routes</a></h4>
<p>En d√©veloppement Web, on appelle <strong>route</strong> une URL ou un ensemble d‚ÄôURLs conduisant √† l‚Äôex√©cution d‚Äôune fonction donn√©e.</p>
<p>Dans Flask, les routes sont d√©clar√©es via le d√©corateur <code>@app.route</code>, comme dans l‚Äôexemple ci-dessus.
Une route peut √™tre param√©tr√©e, auquel cas le param√™tre sera pass√© √† la fonction vue :</p>
<pre><code class="language-python">@app.route(&quot;/hello/&lt;name&gt;&quot;)
def hello(name):
    return &quot;Hello {}&quot;.format(name)
</code></pre>
<p><span class="tryit">Pour tester</span> : <a href="http://mthh.pythonanywhere.com/hello/John">http://mthh.pythonanywhere.com/hello/John</a></p>
<p>Les exemples ci-dessus vous permettent de personnaliser la r√©ponse en fonction de la demande de l'utilisateur ou de faire effectuer des calculs cot√© serveur en b√©n√©ficiant de la puissance et de l'√©tendue des fonctionnalit√©s offertes par python et son √©cosyst√®me.</p>
<ul>
<li>Il est √©galement possible de sp√©cifier plusieurs param√®tres lors de la d√©finition d'une route en utilisant la forme <code>/hello/&lt;a&gt;/&lt;b&gt;</code> :</li>
</ul>
<pre><code class="language-python">@app.route(&quot;/add/&lt;a&gt;/&lt;b&gt;&quot;)
def add(a, b):
    return &quot;Result: {}&quot;.format(int(a) + int(b))
</code></pre>
<p><span class="tryit">Pour tester</span> : <a href="http://mthh.pythonanywhere.com/add/3/12">http://mthh.pythonanywhere.com/add/3/12</a></p>
<ul>
<li>Il est possible de sp√©cifier le type attendu pour les param√®tres de la route ; s'ils ne sont pas satisfaits, une r√©ponse de type <code>404 - NOT FOUND</code> sera renvoy√© par d√©faut :</li>
</ul>
<pre><code class="language-python">@app.route(&quot;/add/&lt;int:a&gt;/&lt;int:b&gt;&quot;)
def add(a, b):
    return &quot;Result: {}&quot;.format(a + b)
</code></pre>
<p><span class="tryit">Pour tester</span> : <a href="http://mthh.pythonanywhere.com/add/12/abc">http://mthh.pythonanywhere.com/add/12/abc</a></p>
<p>Un r√©ponse <code>404 - NOT FOUND</code> sera √©galement renvoy√©e si vous essayer d'acc√©der √† une route qui n'est pas d√©finie (ici <code>abdef</code>) :</p>
<p><span class="tryit">Pour tester</span> : <a href="http://mthh.pythonanywhere.com/abdef">http://mthh.pythonanywhere.com/abdef</a></p>
<ul>
<li>Par commodit√©e il est √©galement possible de sp√©cifier plusieurs routes conduisant √† l'ex√©cution d'une fonction :</li>
</ul>
<pre><code class="language-python">@app.route(&quot;/greetings&quot;)
@app.route(&quot;/greetings/&lt;name&gt;&quot;)
def greetings(name=None):
    return &quot;Hello {} !&quot;.format(name or 'world')
</code></pre>
<p><span class="tryit">Pour tester</span> : <a href="http://mthh.pythonanywhere.com/greetings">http://mthh.pythonanywhere.com/greetings</a>
<br>
<span class="tryit">Pour tester</span> : <a href="http://mthh.pythonanywhere.com/greetings/Paul">http://mthh.pythonanywhere.com/greetings/Paul</a></p>
<h4><a class="header" href="#m√©thodes-http" id="m√©thodes-http">M√©thodes HTTP</a></h4>
<p>Lors de la cr√©ation d'une route, il est possible de sp√©cifier la ou les m√©thodes par laquelle elle est accessible. Dans les exemples pr√©c√©dents, comme aucune m√©thode n'√©tait sp√©cifi√©e explicitement, il s'agissait de la m√©thode <strong>GET</strong>. Ainsi notre premi√®re fonction aurait pu √™tre √©crite de la mani√®re qui suit :</p>
<pre><code class="language-python">@app.route(&quot;/&quot;, methods=['GET'])
def root():
    return &quot;Hello from Flask!&quot;
</code></pre>
<p>Une route qui accepte seulement une m√©thode <strong>POST</strong> sera donc d√©clar√©e de la mani√®re suivante :</p>
<pre><code class="language-python">@app.route('/valid-form', methods=['POST'])
</code></pre>
<p>Il pourra parfois √™tre n√©cessaire de cr√©er des routes qui acceptent les deux m√©thodes. Prenons l'exemple du code ci-dessous. La route <code>/update</code> est cr√©√©e pour accepter les m√©thodes <strong>GET</strong> et <strong>POST</strong> :</p>
<pre><code class="language-python">from flask import request, render_template

@app.route('/update', methods=['GET', 'POST'])
def example():
    if request.method == 'GET':
        return render_template('update.html')
    elif request.method == 'POST':
        # traitement des donn√©es envoy√©es ...
        return 'Entry updated' !

</code></pre>
<ul>
<li>S'il s'agit d'une requ√™te de type <strong>GET</strong>, la page qui correspond au <em>template</em> <code>update.html</code> sera retourn√©e au client <em>(on s'imagine qu'elle contient notamment un formulaire permettant de mettre √† jour une entr√©e dans la BD)</em>.</li>
<li>S'il s'agit d'une requ√™te de type <strong>POST</strong>, les donn√©es envoy√©es sont trait√©es pour mettre √† jour l'entr√©e <em>(cette action correspond √† la validation et √† l'envoi, par le client, du formulaire contenu dans la page auquel il a acced√© pr√©c√©dement par la route <code>/update</code>)</em> :</li>
</ul>
<h3><a class="header" href="#22-templates" id="22-templates">2.2 <em>Templates</em></a></h3>
<p><strong><code>Flask</code></strong> dispose d'un m√©canisme qui permet d'utiliser un <strong>mod√®le</strong> <em>(template)</em> de document dont certaines parties seront remplac√©es dynamiquement √† l'ex√©cution, avant d'√™tre envoy√© au client.</p>
<p>Les exemples pr√©sent√©s jusqu'ici ne renvoient que des cha√Ænes de caract√®res. Comme indiqu√© plus haut, il s'agit en r√©alit√© de contenu HTML ; vous pouvez ainsi √©crire des routes renvoyant du contenu HTML correctement formatt√© et g√©n√©r√© de mani√®re dynamique:</p>
<pre><code class="language-python">from datetime import date

@app.route(&quot;/pretty-add/&lt;int:a&gt;/&lt;int:b&gt;&quot;)
def pretty_add(a, b):
    current_date = date.today().isoformat()
    result = a + b
    return &quot;&quot;&quot;
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;title&gt;Addition result page&lt;/title&gt;
      &lt;/head&gt;
      &lt;body style=&quot;text-align:center;&quot;&gt;
        &lt;h1&gt;Result page&lt;/h1&gt;
        &lt;p&gt;{} + {} = &lt;strong&gt;{}&lt;/strong&gt;&lt;/p&gt;
        &lt;hr/&gt;
        &lt;p&gt;&lt;em&gt;Computed on {}&lt;/em&gt;&lt;/p&gt;
      &lt;/body&gt;
    &lt;/html&gt;&quot;&quot;&quot;.format(a, b, result, current_date)
</code></pre>
<p><span class="tryit">Pour tester</span> : <a href="http://mthh.pythonanywhere.com/pretty-add/12/20">http://mthh.pythonanywhere.com/pretty-add/12/20</a></p>
<p>Si cette m√©thode est utilisable, elle va toutefois vite rendre votre code difficilement compr√©hensible et elle ne facilite pas la r√©utilisation de morceau de code qui pourraient l'√™tre.</p>
<p>C'est ici que l'int√©r√™t du <strong>moteur de <em>templates</em></strong> rentre en jeu. Ce dernier va permettre de stocker dans des fichiers s√©par√©s le <strong>mod√®le</strong> de nos pages HTML. Lors de l'ex√©cution (avec la fonction <code>render_template</code> pr√©sent√©e ensuite), le mod√®le va √™tre compl√©t√© avec les param√®tres fournis pour produire un document HTML utilisable par le client.</p>
<h4><a class="header" href="#syntaxe-utilis√©e-par-jinja2" id="syntaxe-utilis√©e-par-jinja2">Syntaxe utilis√©e par <code>Jinja2</code></a></h4>
<p>Reprenons l'exemple de notre route <code>pretty-add</code> d√©finit ci-dessus ; il est possible de d√©finir (dans un fichier <code>template/pretty-add.html</code> par exemple) le <em>template</em> suivant:</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;title&gt;Addition result page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body style=&quot;text-align:center;&quot;&gt;
    &lt;h1&gt;Result page&lt;/h1&gt;
    &lt;p&gt;{{ a }} + {{ b }} = &lt;strong&gt;{{ result }}&lt;/strong&gt;&lt;/p&gt;
    &lt;hr/&gt;
    &lt;p&gt;&lt;em&gt;Computed on {{ current_date }}&lt;/em&gt;&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>... et de r√©√©crire la fonction de la mani√®re suivante :</p>
<pre><code class="language-python">from Flask import render_template

@app.route(&quot;/pretty-add/&lt;int:a&gt;/&lt;int:b&gt;&quot;)
def pretty_add(a, b):
    date_now = date.today().isoformat()
    result = a + b
    return render_template('pretty-add.html',
                           a=a,
                           b=b,
                           result=result,
                           current_date=date_now)
</code></pre>
<p>Dans cet exemple nous avons utilis√©:</p>
<ul>
<li>des <strong>expressions</strong>, d√©limit√©es par les symboles <code>{{ ... }}</code> ; elles peuvent contenir des expressions Python et ici, lorsqu'on √©crit <code>{{ result }}</code> on cherche donc √† utiliser le contenu de la variable <code>result</code> pour l'afficher dans la page HTML qui sera renvoy√©e.</li>
</ul>
<p>D'autres constructions peuvent √™tre utilis√©es:</p>
<ul>
<li>des <strong>d√©clarations</strong> <em>(statements)</em>, d√©limit√©s avec les symboles <code>{% ... %}</code> (conditions, boucles, etc.),</li>
<li>des <strong>commentaires</strong>, d√©limit√©s avec les symboles <code>{# ... #}</code>.</li>
</ul>
<blockquote>
<p><strong>Remarque:</strong> La fonction <code>render_template</code> accepte les variables attendues par le <em>template</em> (son premier argument) en tant qu'arguments optionnels nomm√©s : on utilise le nom de la variable attendue dans le <em>template</em> comme cl√© et le nom de la variable dans le code actuel comme valeur (<code>current_date=date_now</code> dans l'exemple pr√©c√©dent).</p>
</blockquote>
<h4><a class="header" href="#exemple-avec-une-boucle" id="exemple-avec-une-boucle">Exemple avec une boucle</a></h4>
<p>Il va ainsi √™tre possible d'utiliser, dans les <em>templates</em> des d√©clarations Python complexes ainsi que diff√©rents √©l√©ments utilis√©s habituellement pour le contr√¥le du flux d'ex√©cution du programme. Regardez le code de ce <em>template</em> :</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;title&gt;My Webpage&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;ul id=&quot;navigation&quot;&gt;
    {% for item in navigation %}
        &lt;li&gt;&lt;a href=&quot;{{ item['href'] }}&quot;&gt;{{ item['caption'] }}&lt;/a&gt;&lt;/li&gt;
    {% endfor %}
    &lt;/ul&gt;

    &lt;h1&gt;My Webpage&lt;/h1&gt;
    &lt;p&gt;Hello {{ name }}&lt;/p&gt;

    {#
      A multi
          -line
        comment
    #}
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><u>Explications :</u></p>
<ul>
<li>La variable <code>navigation</code> est ici une <code>list</code> de <code>dict</code>, de la forme
<pre><code class="language-python">navigation = [
    {&quot;href&quot;: &quot;index.html&quot;, &quot;caption&quot;: &quot;Accueil&quot;},
    {&quot;href&quot;: &quot;partenaires.html&quot;, &quot;caption&quot;: &quot;Partenaires&quot;}
]
</code></pre>
il est possible d'utiliser la d√©claration <strong><code>{% for item in navigation %}</code></strong> qui a le m√™me effet qu'une boucle utilisant <code>for</code> en Python - la syntaxe utilis√©e ici n√©cessite toutefois de fermer le bloc correspondant √† cette boucle avec la d√©claration <strong><code>{% endfor %}</code></strong>.</li>
<li>La variable <code>name</code> est de type <code>str</code> et on l'affiche telle-quelle.</li>
<li>La dernier bloc <code>{# ... #}</code> correspond √† un commentaire ; comme dans les autres langages, servez-vous en si n√©cessaire !</li>
<li>Les variables attendues (ici <code>navigation</code> et <code>name</code>) dans le <em>template</em> sont √† donner en arguments optionnels et nomm√©s de la fonction <code>render_template</code>.</li>
</ul>
<h4><a class="header" href="#r√©utilisation-de-templates" id="r√©utilisation-de-templates">R√©utilisation de <em>templates</em></a></h4>
<p>Reprenons l'exemple des pages que nous avons cr√©√©es dans les TP pr√©c√©dents : elles contenaient une barre de navigation et un <em>footer</em> qui avaient tous deux vocation √† √™tre les m√™mes pour chacune des pages du site.</p>
<p>Gr√¢ce au <strong>m√©canisme permettant d'inclure</strong> des <em>templates</em>, nous allons par exemple pouvoir d√©finir dans des fichiers s√©par√©s les √©l√©ments r√©utilisables de notre site, pour les inclure depuis le <em>template</em> contenant le contenu principal de la page :</p>
<pre><code class="language-html">{% include 'header.html' %}
    Contenu principal de la page ici...
{% include 'footer.html' %}
</code></pre>
<p>Les <em>templates</em> appel√©s de cette mani√®re ont acc√®s aux m√™mes variables que le <em>template</em> qui les a inclus.</p>
<h2><a class="header" href="#3---mise-en-pratique--exercice-1--inscription-√†-pythonanywhere-et-d√©marrage-dun-projet-flask" id="3---mise-en-pratique--exercice-1--inscription-√†-pythonanywhere-et-d√©marrage-dun-projet-flask">3 - Mise en pratique üöÄ Exercice 1 üöÄ Inscription √† PythonAnywhere et d√©marrage d'un projet <code>Flask</code></a></h2>
<h3><a class="header" href="#31-inscription-√†-pythonanywhere" id="31-inscription-√†-pythonanywhere">3.1 Inscription √† PythonAnywhere</a></h3>
<p>L'inscription se passe √† l'URL suivante : <a href="https://www.pythonanywhere.com/registration/register/beginner/">https://www.pythonanywhere.com/registration/register/beginner/</a>.</p>
<p>Cette plateforme va vous permettre d'√©xecuter du code Python sur un serveur distant. Cette solution peut √™tre utile si vous voulez vous lib√©rer des contraintes li√©es √† la plateforme sur laquelle vous travaillez (syst√®me d'exploitation, droits administrateurs, etc.).</p>
<p>Dans notre cas, elle va √™tre utile car elle permet d'h√©berger une application Web (cr√©ee avec <code>Flask</code> mais aussi avec <code>Web2py</code> ou <code>Django</code>) et d'y acc√©der √† une URL de la forme <strong><code>http://{pseudonyme}.pythonanywhere.com</code></strong>.</p>
<p>Suivez les indications suivantes pour y cr√©er une application <code>Flask</code> vide.</p>
<ul>
<li>Apr√®s vous √™tre enregistr√© et logg√© sur la plateforme, cliquez sur le bouton <strong>&quot;Web&quot;</strong> :</li>
</ul>
<p><img src="img/pa1.png" alt="" /></p>
<ul>
<li>Cliquez sur le bouton &quot;Add a new web app&quot; :</li>
</ul>
<p><img src="img/pa2.png" alt="" /></p>
<ul>
<li>Une fenetre s'ouvre, cliquez sur &quot;next&quot; :</li>
</ul>
<p><img src="img/pa3.png" alt="" /></p>
<ul>
<li>Choisissez d'utiliser le <em>framework</em> <strong>Flask</strong> :</li>
</ul>
<p><img src="img/pa4.png" alt="" /></p>
<ul>
<li>S√©lectionnez la version de Python avec laquelle vous avez l'habitude de travailler :</li>
</ul>
<p><img src="img/pa5.png" alt="" /></p>
<ul>
<li>Ne modifiez pas le chemin du fichier <code>flask_app.py</code> et cliquez sur &quot;next&quot; :</li>
</ul>
<p><img src="img/pa6.png" alt="" /></p>
<ul>
<li>L'application est cr√©√©e et accessible √† l'URL <strong><code>https://{pseudonyme}.pythonanywhere.com</code></strong>. Cliquez sur le bouton &quot;Files&quot; pour √©diter le code de votre serveur :</li>
</ul>
<p><img src="img/pa7.png" alt="" /></p>
<ul>
<li>Naviguez dans l'arborescence jusqu'√† trouver ce fichier. Cliquez pour l'ouvrir :</li>
</ul>
<p><img src="img/pa8.png" alt="" /></p>
<ul>
<li>Vous pouvez l'√©diter (et le sauvegarder en faisant <kbd>ctrl</kbd> +  <kbd>s</kbd> par exemple).</li>
</ul>
<p><img src="img/pa9.png" alt="" /></p>
<ul>
<li>Apr√®s l'avoir √©dit√©, vous devez recharger votre <em>web app</em>. Cela peut se faire directement depuis la page de l'√©diteur de code (image ci-dessous) ou depuis la section <strong>Web</strong> de votre espace <em>PythonAnywhere</em>.</li>
</ul>
<p><img src="img/pa10.png" alt="" /></p>
<p><strong>üöÄ Rechargez votre application et v√©rifiez que tout fonctionne correctement</strong>, l'URL √† utiliser est <strong><code>https://{pseudonyme}.pythonanywhere.com</code></strong>.</p>
<p><img src="img/pa10.png" alt="" /></p>
<blockquote>
<p><strong>Remarque:</strong> Vous pouvez consulter les logs d'erreur de l'application √† l'adresse <small>https://www.pythonanywhere.com/user/{pseudonyme}/files/var/log/{pseudonyme}.pythonanywhere.com.error.log</small></p>
</blockquote>
<h3><a class="header" href="#32-premiers-pas-avec-flask-et-structure-du-projet" id="32-premiers-pas-avec-flask-et-structure-du-projet">3.2 Premiers pas avec Flask et structure du projet</a></h3>
<p>Dans le dossier <code>mysite</code> vous disposez dor√©navant d'un fichier <code>flask_app.py</code>.</p>
<p>Il est √©galement n√©cessaire de cr√©er un dossier que vous nommerez <code>templates</code>. Dans le dossier <code>templates</code> vous d√©compresserez les donn√©es du jour : <a href="data/TP5.zip">donn√©es TP5</a> - il s'agit de 2 fichiers de <em>templates</em> utilisant <code>Jinja2</code>.</p>
<p>Vous devez donc avoir la structure de projet suivante:</p>
<pre><code>mysite
‚îú‚îÄ‚îÄ templates           &lt;--- Le dossier contenant nos mod√®les de documents HTML
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ header.html     
‚îî‚îÄ‚îÄ flask_app.py        &lt;--- Le code de l'appli Web √† r√©aliser
</code></pre>
<h2><a class="header" href="#4-mise-en-pratique--exercice-2--modification-de-lapplication" id="4-mise-en-pratique--exercice-2--modification-de-lapplication">4. Mise en pratique üöÄ Exercice 2 üöÄ Modification de l'application</a></h2>
<ol>
<li>Ajoutez le morceau de code suivant dans le fichier <code>flask_app.py</code>, il s'agit des premiers avis fictifs √† utiliser avant que nous ne constituions la base de donn√©es dans le TP suivant:</li>
</ol>
<pre><code class="language-python">entries = [
 {&quot;id_review&quot;: 1, &quot;id_batiment&quot;: 26, &quot;rate&quot;: 5, &quot;comment&quot;: &quot;Mattis molestie a iaculis at erat pellentesque adipiscing commodo.&quot;},
 {&quot;id_review&quot;: 2, &quot;id_batiment&quot;: 18, &quot;rate&quot;: 4, &quot;comment&quot;: &quot;Amet massa vitae tortor condimentum lacinia.&quot;},
 {&quot;id_review&quot;: 3, &quot;id_batiment&quot;: 31, &quot;rate&quot;: 3, &quot;comment&quot;: &quot;Imperdiet sed euismod nisi porta lorem mollis aliquam.&quot;},
 {&quot;id_review&quot;: 4, &quot;id_batiment&quot;: 22, &quot;rate&quot;: 1, &quot;comment&quot;: &quot;Dignissim enim sit amet venenatis. Urna cursus eget nunc scelerisque.&quot;},
 {&quot;id_review&quot;: 5, &quot;id_batiment&quot;: 26, &quot;rate&quot;: 4, &quot;comment&quot;: &quot;A pellentesque sit amet porttitor eget dolor morbi.&quot;},
 {&quot;id_review&quot;: 6, &quot;id_batiment&quot;: 18, &quot;rate&quot;: 3, &quot;comment&quot;: &quot;Consequat nisl vel pretium lectus quam id leo in vitae.&quot;},
]
</code></pre>
<ol start="2">
<li>
<p>Vous devez modifier la route existante afin que la route <code>/</code> et la route <code>/index</code> appellent toutes deux la fonction <code>root</code>. Cette fonction devra utiliser le <em>template</em> <code>index.html</code>. Vous devrez √©galement ouvrir ce fichier de <em>template</em> pour voir les variables qui sont attendues et que vous devrez donner en argument √† la fonction <code>render_template</code>.</p>
</li>
<li>
<p>Vous devez cr√©er une nouvelle route du nom de <code>/review</code> doit accepter un argument de type <code>int</code>, l'identifiant de l'avis que l'utilisateur souhaite obtenir. Vous devez √©galement √©crire la fonction correspondante : pour un identifiant donn√©, elle doit renvoyer la note et l'avis sous forme d'un bloc de texte formatt√© de mani√®re simple <em>(par exemple: &quot;Note X - Commentaire : xxxxx&quot;)</em>. Si aucun avis ne correspond √† l'identifiant, elle retourne une cha√Æne de caract√®res vide.</p>
</li>
<li>
<p>Dans votre navigateur, v√©rifiez les points suivants avant de passer √† l'exercice qui suit:</p>
</li>
</ol>
<ul>
<li>les routes <code>/</code> et <code>/index</code> fonctionnent et renvoient le m√™me contenu (cf. image).</li>
<li>la route <code>/review</code> retourne une erreur <code>404 - NOT FOUND</code> alors que la route <code>/review/2</code> retourne bien le contenu de l'avis correspondant.</li>
</ul>
<div class="center">
<p><img src="img/tp5_ex2_index.png" alt="Capture d'√©cran de la route &quot;/index&quot;" />
<img src="img/tp5_ex2_review.png" alt="Capture d'√©cran de la route &quot;/review/2&quot;" /></p>
</div>
<h2><a class="header" href="#5-mise-en-pratique--exercice-3--utilisation-des-templates" id="5-mise-en-pratique--exercice-3--utilisation-des-templates">5. Mise en pratique üöÄ Exercice 3 üöÄ Utilisation des <em>templates</em></a></h2>
<ol>
<li>En plus d'afficher le nombre d'avis pr√©sents dans la base, nous souhaitons afficher la totalit√© de la liste des avis sur la page d'accueil. Vous devez modifier le <em>template</em> <code>index.html</code> pour cr√©er dynamiquement une liste HTML o√π chaque item correspondra √† un avis de la <code>list</code> Python appell√©e <code>entries</code>. Un exemple similaire a √©t√© donn√© <a href="#exemple-avec-une-boucle">ici</a>.</li>
</ol>
<div class="center">
<p><img src="img/tp5_ex3_resultat.png" alt="Capture d'√©cran de la route &quot;/index&quot;" /></p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="4-css-bootstrap.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="6-serveur-client2.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="4-css-bootstrap.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="6-serveur-client2.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="src/custom.js"></script>
        

        

    </body>
</html>
